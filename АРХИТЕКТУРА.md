# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° VPN Mini App

## ğŸ“š Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

### Backend
- **Runtime:** Node.js 20 LTS
- **Framework:** Next.js 16 (App Router)
- **Language:** TypeScript 5.x (strict mode)
- **ORM:** Prisma 6.x
- **Database:** PostgreSQL 16
- **Cache/Queue:** Redis 7.x
- **Validation:** Zod
- **API Docs:** Swagger/OpenAPI

### Frontend
- **UI Library:** React 19
- **Components:** shadcn/ui + Radix UI
- **Styling:** Tailwind CSS 4.x
- **Icons:** Lucide React
- **State:** React Context + Zustand (Ğ´Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚ĞµĞ¹Ñ‚Ğ°)
- **Forms:** React Hook Form + Zod

### DevOps & Deployment
- **Containerization:** Docker + Docker Compose
- **Web Server:** Nginx (reverse proxy)
- **Process Manager:** PM2 (Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°)
- **Monitoring:** Prometheus + Grafana (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
- **Logs:** Winston + JSON format

### VPN Infrastructure
- **Protocol:** WireGuard
- **Agent:** Custom HTTPS API (Node.js + Express)
- **Server OS:** Ubuntu 22.04 LTS

---

## ğŸ—‚ï¸ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
telegram-vpn-app/
â”œâ”€â”€ docker/                      # Docker ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”œâ”€â”€ docker-compose.yml       # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ compose file
â”‚   â”œâ”€â”€ docker-compose.dev.yml   # Development overrides
â”‚   â”œâ”€â”€ Dockerfile               # App container
â”‚   â”œâ”€â”€ Dockerfile.agent         # VPN Agent container
â”‚   â”œâ”€â”€ nginx.conf               # Nginx config
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ prisma/                      # Prisma ORM
â”‚   â”œâ”€â”€ schema.prisma            # Database schema
â”‚   â”œâ”€â”€ migrations/              # Database migrations
â”‚   â””â”€â”€ seed.ts                  # Seed data Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/                 # ğŸ”¥ ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
â”‚   â”‚   â”œâ”€â”€ auth/                # ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.validation.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ subscriptions/       # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions.types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions.validation.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ payments/            # TON Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ payments.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ton-client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ payments.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ vpn/                 # VPN ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
â”‚   â”‚   â”‚   â”œâ”€â”€ vpn.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ wireguard.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ip-pool.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ agent-client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ vpn.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ servers/             # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ servers.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ health-check.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ load-balancer.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ servers.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ referrals/           # Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ referrals.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ referrals.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ referrals.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ support/             # Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ support.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ support.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ support.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ notifications/       # Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ telegram-bot.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ analytics/           # ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ metrics.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.types.ts
â”‚   â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ promo/               # ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ñ‹
â”‚   â”‚       â”œâ”€â”€ promo.service.ts
â”‚   â”‚       â”œâ”€â”€ promo.controller.ts
â”‚   â”‚       â”œâ”€â”€ promo.types.ts
â”‚   â”‚       â””â”€â”€ __tests__/
â”‚   â”‚
â”‚   â”œâ”€â”€ app/                     # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (miniapp)/           # Telegram Mini App (CSR)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ subscribe/
â”‚   â”‚   â”‚   â”œâ”€â”€ servers/
â”‚   â”‚   â”‚   â”œâ”€â”€ referral/
â”‚   â”‚   â”‚   â”œâ”€â”€ support/
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ notifications/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/               # Admin panel (SSR)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ servers/
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                 # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”œâ”€â”€ vpn/
â”‚   â”‚   â”‚   â”œâ”€â”€ servers/
â”‚   â”‚   â”‚   â”œâ”€â”€ referrals/
â”‚   â”‚   â”‚   â”œâ”€â”€ support/
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â”‚   â”œâ”€â”€ promo/
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â””â”€â”€ cron/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # React components
â”‚   â”‚   â”œâ”€â”€ ui/                  # shadcn/ui components
â”‚   â”‚   â”œâ”€â”€ miniapp/             # Mini app specific
â”‚   â”‚   â”œâ”€â”€ admin/               # Admin panel specific
â”‚   â”‚   â””â”€â”€ shared/              # Shared components
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                     # Shared utilities
â”‚   â”‚   â”œâ”€â”€ prisma.ts            # Prisma client singleton
â”‚   â”‚   â”œâ”€â”€ redis.ts             # Redis client
â”‚   â”‚   â”œâ”€â”€ telegram.ts          # Telegram WebApp utils
â”‚   â”‚   â”œâ”€â”€ logger.ts            # Winston logger
â”‚   â”‚   â”œâ”€â”€ errors.ts            # Custom error classes
â”‚   â”‚   â”œâ”€â”€ validation.ts        # Validation helpers
â”‚   â”‚   â””â”€â”€ constants.ts         # App constants
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                   # React hooks
â”‚   â”‚   â”œâ”€â”€ use-telegram.ts
â”‚   â”‚   â”œâ”€â”€ use-subscription.ts
â”‚   â”‚   â””â”€â”€ use-toast.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # Global TypeScript types
â”‚       â”œâ”€â”€ telegram.types.ts
â”‚       â””â”€â”€ global.d.ts
â”‚
â”œâ”€â”€ agent/                       # VPN Server Agent (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts             # Express server
â”‚   â”‚   â”œâ”€â”€ wireguard.service.ts # WireGuard operations
â”‚   â”‚   â”œâ”€â”€ health.service.ts    # Health checks
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ docs/                        # Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ api/                     # API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ (Swagger)
â”‚   â”‚   â”œâ”€â”€ auth.md
â”‚   â”‚   â”œâ”€â”€ subscriptions.md
â”‚   â”‚   â”œâ”€â”€ payments.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ deployment.md            # Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ
â”‚   â”œâ”€â”€ development.md           # Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
â”‚   â””â”€â”€ architecture.md          # Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»
â”‚
â”œâ”€â”€ scripts/                     # Utility scripts
â”‚   â”œâ”€â”€ setup-dev.sh             # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° dev Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
â”‚   â”œâ”€â”€ migrate-db.sh            # Run migrations
â”‚   â”œâ”€â”€ seed-db.sh               # Seed database
â”‚   â””â”€â”€ deploy.sh                # Production deploy
â”‚
â”œâ”€â”€ .github/                     # GitHub Actions (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ deploy.yml
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

---

## ğŸ”„ Data Flow (ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸

```
1. [User] ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ" Ğ² Mini App
   â†“
2. [Frontend] POST /api/payments/create-invoice
   â†“
3. [Payments Module]
   - Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ pending_payment Ğ² Ğ‘Ğ”
   - Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ TON payment URL
   - Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ payment link
   â†“
4. [User] ĞĞ¿Ğ»Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ² TON ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞµ
   â†“
5. [TON Blockchain] â†’ Webhook â†’ POST /api/payments/webhook
   â†“
6. [Payments Module]
   - Ğ’ĞµÑ€Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ
   - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ pending_payment â†’ completed
   - ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ: payment.completed
   â†“
7. [Event Bus - Redis Pub/Sub]
   â”œâ”€â†’ [Subscriptions Module] â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ subscription
   â”œâ”€â†’ [Referrals Module] â†’ ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ñ€ĞµÑ„ĞµÑ€Ğ°Ğ»Ñƒ
   â”œâ”€â†’ [Notifications Module] â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
   â””â”€â†’ [Analytics Module] â†’ Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºÑƒ
   â†“
8. [Subscriptions Module]
   - ĞŸÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ: subscription.created
   â†“
9. [VPN Module] (ÑĞ»ÑƒÑˆĞ°ĞµÑ‚ subscription.created)
   - Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ (load balancer)
   - Ğ ĞµĞ·ĞµÑ€Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ IP Ğ¸Ğ· Ğ¿ÑƒĞ»Ğ°
   - Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ WireGuard ĞºĞ»ÑÑ‡Ğ¸
   - Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Agent API â†’ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ peer
   - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ Ğ² subscription
   â†“
10. [Notifications Module]
    - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ push Ğ² Mini App: "ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°!"
    â†“
11. [User] ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ â†’ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Mini App â†’ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
```

---

## ğŸ—„ï¸ Database Schema (PostgreSQL)

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

```sql
-- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  telegram_id BIGINT UNIQUE NOT NULL,
  first_name TEXT NOT NULL,
  last_name TEXT,
  username TEXT,
  language_code TEXT DEFAULT 'ru',
  referral_code TEXT UNIQUE NOT NULL,
  referred_by UUID REFERENCES users(id),
  referral_balance DECIMAL(10, 2) DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ¢Ğ°Ñ€Ğ¸Ñ„Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ½Ñ‹
CREATE TABLE subscription_plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  duration_days INTEGER NOT NULL,
  price_ton DECIMAL(10, 2) NOT NULL,
  price_usd DECIMAL(10, 2) NOT NULL,
  max_configs INTEGER NOT NULL DEFAULT 1,
  features JSONB,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  plan_id UUID REFERENCES subscription_plans(id),
  server_id UUID REFERENCES vpn_servers(id),

  -- WireGuard config
  wireguard_config TEXT,
  private_key TEXT,
  public_key TEXT,
  assigned_ip INET,

  status TEXT CHECK (status IN ('active', 'expired', 'cancelled')) DEFAULT 'active',
  starts_at TIMESTAMPTZ NOT NULL,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- VPN Ğ¡ĞµÑ€Ğ²ĞµÑ€Ñ‹
CREATE TABLE vpn_servers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  country TEXT NOT NULL,
  country_code TEXT,
  city TEXT,
  ip_address INET NOT NULL,
  port INTEGER NOT NULL DEFAULT 51820,

  -- WireGuard
  public_key TEXT,
  private_key TEXT,

  -- Agent connection
  agent_secret TEXT NOT NULL,
  agent_port INTEGER DEFAULT 51821,

  -- Capacity
  max_clients INTEGER DEFAULT 250,
  current_clients INTEGER DEFAULT 0,

  -- Status
  is_active BOOLEAN DEFAULT true,
  setup_status TEXT CHECK (setup_status IN ('pending', 'installing', 'ready', 'error')),
  setup_error TEXT,
  setup_log TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- IP Pool (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ°Ğ¶Ğ½Ğ¾!)
CREATE TABLE ip_pools (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  server_id UUID REFERENCES vpn_servers(id) ON DELETE CASCADE,
  ip_address INET NOT NULL,
  is_allocated BOOLEAN DEFAULT false,
  allocated_to UUID REFERENCES subscriptions(id),
  allocated_at TIMESTAMPTZ,
  released_at TIMESTAMPTZ,
  UNIQUE(server_id, ip_address)
);

-- ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸
CREATE TABLE payments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  plan_id UUID REFERENCES subscription_plans(id),
  subscription_id UUID REFERENCES subscriptions(id),

  amount_ton DECIMAL(10, 2) NOT NULL,
  payment_comment TEXT NOT NULL UNIQUE,

  status TEXT CHECK (status IN ('pending', 'completed', 'expired', 'failed')) DEFAULT 'pending',

  tx_hash TEXT,
  verified_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);

-- Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸
CREATE TABLE referral_transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  referrer_id UUID REFERENCES users(id),
  referred_id UUID REFERENCES users(id),
  subscription_id UUID REFERENCES subscriptions(id),
  payment_id UUID REFERENCES payments(id),

  amount_ton DECIMAL(10, 2) NOT NULL,
  percentage DECIMAL(5, 2) NOT NULL,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° Ğ²Ñ‹Ğ²Ğ¾Ğ´
CREATE TABLE withdrawal_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),

  amount_ton DECIMAL(10, 2) NOT NULL,
  wallet_address TEXT NOT NULL,

  status TEXT CHECK (status IN ('pending', 'processing', 'completed', 'rejected')) DEFAULT 'pending',

  tx_hash TEXT,
  admin_note TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  processed_at TIMESTAMPTZ
);

-- ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ñ‹
CREATE TABLE promo_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code TEXT UNIQUE NOT NULL,
  description TEXT,

  duration_days INTEGER NOT NULL,
  max_uses INTEGER,
  current_uses INTEGER DEFAULT 0,

  is_active BOOLEAN DEFAULT true,
  valid_from TIMESTAMPTZ DEFAULT NOW(),
  valid_until TIMESTAMPTZ,

  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ğ¾Ğ²
CREATE TABLE promo_activations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  promo_code_id UUID REFERENCES promo_codes(id),
  user_id UUID REFERENCES users(id),
  subscription_id UUID REFERENCES subscriptions(id),

  activated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(promo_code_id, user_id)
);

-- Ğ¢Ğ¸ĞºĞµÑ‚Ñ‹ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸
CREATE TABLE support_tickets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),

  subject TEXT NOT NULL,
  message TEXT NOT NULL,

  status TEXT CHECK (status IN ('open', 'in_progress', 'resolved', 'closed')) DEFAULT 'open',
  priority TEXT CHECK (priority IN ('low', 'normal', 'high', 'urgent')) DEFAULT 'normal',

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ñ‚Ğ¸ĞºĞµÑ‚Ñ‹
CREATE TABLE ticket_replies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ticket_id UUID REFERENCES support_tickets(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id),

  is_admin BOOLEAN DEFAULT false,
  message TEXT NOT NULL,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),

  title TEXT NOT NULL,
  message TEXT NOT NULL,
  type TEXT CHECK (type IN ('info', 'success', 'warning', 'error', 'news')) DEFAULT 'info',

  is_global BOOLEAN DEFAULT false,
  is_read BOOLEAN DEFAULT false,
  link TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Health checks ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²
CREATE TABLE server_health_checks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  server_id UUID REFERENCES vpn_servers(id) ON DELETE CASCADE,

  status TEXT CHECK (status IN ('online', 'offline', 'degraded')) DEFAULT 'online',
  response_time_ms INTEGER,

  cpu_usage DECIMAL(5, 2),
  ram_usage DECIMAL(5, 2),
  active_peers INTEGER,

  error_message TEXT,

  checked_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
CREATE TABLE traffic_usage (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  subscription_id UUID REFERENCES subscriptions(id) ON DELETE CASCADE,

  bytes_sent BIGINT DEFAULT 0,
  bytes_received BIGINT DEFAULT 0,

  measured_at TIMESTAMPTZ DEFAULT NOW()
);

-- Audit log Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸
CREATE TABLE admin_audit_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID REFERENCES users(id),

  action TEXT NOT NULL,
  resource_type TEXT NOT NULL,
  resource_id UUID,

  old_value JSONB,
  new_value JSONB,

  ip_address INET,
  user_agent TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_referral_code ON users(referral_code);
CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_expires_at ON subscriptions(expires_at);
CREATE INDEX idx_subscriptions_status ON subscriptions(status);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_user_id ON payments(user_id);
CREATE INDEX idx_ip_pools_server_allocated ON ip_pools(server_id, is_allocated);
CREATE INDEX idx_notifications_user_read ON notifications(user_id, is_read);
CREATE INDEX idx_health_checks_server_time ON server_health_checks(server_id, checked_at DESC);
```

---

## ğŸ”Œ API Endpoints Structure

### ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğµ API endpoints

```
/api/auth/*
  POST   /auth/telegram          # Telegram WebApp auth
  POST   /auth/admin             # Admin login
  POST   /auth/logout            # Logout
  GET    /auth/me                # Get current user

/api/subscriptions/*
  GET    /subscriptions                    # List user subscriptions
  GET    /subscriptions/:id                # Get subscription details
  POST   /subscriptions/activate-promo     # Activate promo code
  DELETE /subscriptions/:id                # Cancel subscription

/api/payments/*
  POST   /payments/create-invoice      # Create TON payment
  POST   /payments/webhook             # TON blockchain webhook
  GET    /payments/check/:id            # Check payment status
  GET    /payments/history              # Payment history

/api/vpn/*
  POST   /vpn/generate-config           # Generate VPN config
  POST   /vpn/regenerate-config/:id     # Regenerate config (rotate keys)
  GET    /vpn/config/:id                # Download config
  DELETE /vpn/config/:id                # Delete config

/api/servers/*
  GET    /servers                       # List available servers
  GET    /servers/:id                   # Server details
  POST   /servers/setup                 # Setup new server (admin)
  GET    /servers/:id/health            # Server health check
  GET    /servers/stats                 # Aggregate stats (admin)

/api/referrals/*
  GET    /referrals/stats               # Referral statistics
  GET    /referrals/list                # List referrals
  POST   /referrals/withdraw            # Request withdrawal

/api/support/*
  GET    /support/tickets               # List tickets
  GET    /support/tickets/:id           # Ticket details
  POST   /support/tickets               # Create ticket
  POST   /support/tickets/:id/reply     # Reply to ticket
  PATCH  /support/tickets/:id           # Update ticket status (admin)

/api/notifications/*
  GET    /notifications                 # List notifications
  PATCH  /notifications/:id/read        # Mark as read
  DELETE /notifications/:id             # Delete notification

/api/promo/*
  POST   /promo/generate                # Generate promo code (admin)
  GET    /promo                         # List promo codes (admin)
  GET    /promo/:id                     # Promo code details
  PATCH  /promo/:id                     # Update promo code
  DELETE /promo/:id                     # Deactivate promo code
  GET    /promo/stats                   # Promo usage stats

/api/analytics/*
  GET    /analytics/dashboard           # Main metrics (admin)
  GET    /analytics/revenue             # Revenue analytics
  GET    /analytics/users               # User analytics
  GET    /analytics/servers             # Server analytics

/api/cron/*
  POST   /cron/expire-subscriptions     # Expire old subscriptions
  POST   /cron/health-checks            # Run server health checks
  POST   /cron/cleanup-old-data         # Cleanup old records
```

---

## ğŸš€ Deployment Architecture

### Production Setup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer (Optional)        â”‚
â”‚              Nginx / HAProxy            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Server             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Docker Container: App        â”‚    â”‚
â”‚  â”‚   - Next.js (Node.js)          â”‚    â”‚
â”‚  â”‚   - PM2                         â”‚    â”‚
â”‚  â”‚   - Port: 3000                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Docker Container: Postgres   â”‚    â”‚
â”‚  â”‚   - PostgreSQL 16              â”‚    â”‚
â”‚  â”‚   - Port: 5432 (internal)      â”‚    â”‚
â”‚  â”‚   - Volume: /var/lib/postgresqlâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Docker Container: Redis      â”‚    â”‚
â”‚  â”‚   - Redis 7.x                  â”‚    â”‚
â”‚  â”‚   - Port: 6379 (internal)      â”‚    â”‚
â”‚  â”‚   - Volume: /data              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Docker Container: Nginx      â”‚    â”‚
â”‚  â”‚   - Reverse Proxy              â”‚    â”‚
â”‚  â”‚   - SSL/TLS                     â”‚    â”‚
â”‚  â”‚   - Port: 80, 443               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           VPN Servers (N ÑˆÑ‚ÑƒĞº)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   WireGuard + Custom Agent     â”‚    â”‚
â”‚  â”‚   - Ubuntu 22.04               â”‚    â”‚
â”‚  â”‚   - WireGuard interface wg0    â”‚    â”‚
â”‚  â”‚   - Agent API: Port 51821      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Docker Compose Ñ„Ğ°Ğ¹Ğ» (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)

```yaml
version: '3.9'

services:
  app:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: vpn-app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://vpn:password@postgres:5432/vpn_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - vpn-network
    volumes:
      - ./logs:/app/logs

  postgres:
    image: postgres:16-alpine
    container_name: vpn-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: vpn
      POSTGRES_PASSWORD: password
      POSTGRES_DB: vpn_db
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - vpn-network
    ports:
      - "5432:5432"  # Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ·Ğ²Ğ½Ğµ (Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°)

  redis:
    image: redis:7-alpine
    container_name: vpn-redis
    restart: unless-stopped
    volumes:
      - redis-data:/data
    networks:
      - vpn-network
    ports:
      - "6379:6379"  # Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ·Ğ²Ğ½Ğµ (Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°)

  nginx:
    image: nginx:alpine
    container_name: vpn-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./docker/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./docker/ssl:/etc/nginx/ssl:ro
    depends_on:
      - app
    networks:
      - vpn-network

volumes:
  postgres-data:
  redis-data:

networks:
  vpn-network:
    driver: bridge
```

---

## âš¡ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°

### Development

```bash
# 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
git clone https://github.com/your-org/vpn-mini-app.git
cd vpn-mini-app

# 2. ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ .env
cp docker/.env.example docker/.env
# ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ .env (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¸ ĞºĞ»ÑÑ‡Ğ¸)

# 3. ĞŸĞ¾Ğ´Ğ½ÑÑ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ (dev Ñ€ĞµĞ¶Ğ¸Ğ¼)
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml up -d

# 4. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
docker exec vpn-app npm run prisma:migrate

# 5. Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
docker exec vpn-app npm run db:seed

# 6. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
# Mini App: http://localhost:3000
# Admin: http://localhost:3000/admin
# API Docs: http://localhost:3000/api/docs
```

### Production

```bash
# 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
git clone https://github.com/your-org/vpn-mini-app.git
cd vpn-mini-app

# 2. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ production .env
cp docker/.env.example docker/.env
nano docker/.env  # Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ production Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ

# 3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ production ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹
docker-compose -f docker/docker-compose.yml up -d

# 4. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
docker exec vpn-app npm run prisma:migrate:deploy

# 5. Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!
# ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ½Ğ° Ğ²Ğ°ÑˆĞµĞ¼ Ğ´Ğ¾Ğ¼ĞµĞ½Ğµ
```

---

## ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸

### ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ²

```bash
# Ğ›Ğ¾Ğ³Ğ¸ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
docker-compose -f docker/docker-compose.yml logs -f

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
docker-compose -f docker/docker-compose.yml logs -f app

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
docker-compose -f docker/docker-compose.yml logs -f postgres
```

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸

- **Health endpoint:** `GET /api/health`
- **Metrics endpoint:** `GET /api/metrics` (Prometheus format)
- **Database stats:** Ğ’ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞµ Ğ½Ğ° `/admin/monitoring`

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²

```bash
# Unit tests
npm run test

# Integration tests
npm run test:integration

# E2E tests
npm run test:e2e

# Coverage
npm run test:coverage
```

---

**Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³:** ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ñ ÑÑ‚Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¾Ğ¹! ğŸš€
