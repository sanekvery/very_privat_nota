# üß† –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç —Å—É–ø–µ—Ä_—É–º–Ω–∏–∫–∞

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–æ:

1. **–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ç–∞—Ä–∏—Ñ—ã**
   - –†–∞–∑–Ω—ã–µ –ø–ª–∞–Ω—ã —Å —Ü–µ–Ω–∞–º–∏ –≤ TON/USD
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ (cron job)

2. **–ü—Ä–æ–º–æ–∫–æ–¥—ã**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

3. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Å –æ–ø–ª–∞—Ç—ã —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
   - –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

4. **–ê–≥–µ–Ω—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö**
   - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π API —á–µ—Ä–µ–∑ HTTPS + Bearer token
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ä–∞–º–∏ (add/remove)

5. **–ê–¥–º–∏–Ω–∫–∞**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## üöÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞–º–∏ (–í–ê–ñ–ù–û!)**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ IP –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º, –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–ª–ª–∏–∑–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É ip_pool
CREATE TABLE ip_pools (
  id UUID PRIMARY KEY,
  server_id UUID REFERENCES vpn_servers(id),
  ip_address INET NOT NULL,
  is_allocated BOOLEAN DEFAULT FALSE,
  allocated_to UUID REFERENCES subscriptions(id),
  allocated_at TIMESTAMPTZ,
  UNIQUE(server_id, ip_address)
);

// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ - —Å—Ä–∞–∑—É –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø—É–ª
// 10.0.0.2 - 10.0.0.254 (253 –∞–¥—Ä–µ—Å–∞)
// –ü—Ä–∏ –≤—ã–¥–∞—á–µ –∫–æ–Ω—Ñ–∏–≥–∞ - SELECT ... WHERE is_allocated=false LIMIT 1 FOR UPDATE
// –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ - –æ—Å–≤–æ–±–æ–¥–∏—Ç—å IP –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—É–ª
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –∫–æ–ª–ª–∏–∑–∏–π IP
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP
- –í–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω–æ –º–µ—Å—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

### 2. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –≤—Ä—É—á–Ω—É—é - –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã–±–∏—Ä–∞—Ç—å —Å–µ—Ä–≤–µ—Ä —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: –°–µ—Ä–≤–µ—Ä—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–µ)
- **Geo-–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞**: –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –†–æ—Å—Å–∏–∏ - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞–º –±–ª–∏–∂–µ

```typescript
// –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
function selectOptimalServer(country?: string): Server {
  return servers
    .filter(s => s.is_active && s.current_clients < s.max_clients)
    .filter(s => !country || s.country === country) // geo-—Ñ–∏–ª—å—Ç—Ä
    .sort((a, b) => {
      const loadA = a.current_clients / a.max_clients
      const loadB = b.current_clients / b.max_clients
      return loadA - loadB
    })[0]
}
```

---

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**

**–î–æ–±–∞–≤–∏—Ç—å:**
- **Health checks**: –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–≥–µ–Ω—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- **–ú–µ—Ç—Ä–∏–∫–∏**: CPU, RAM, bandwidth usage
- **–ê–ª–µ—Ä—Ç—ã –≤ Telegram**: –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω > 5 –º–∏–Ω—É—Ç
- **Dashboard**: Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```typescript
// –¢–∞–±–ª–∏—Ü–∞ health_checks
CREATE TABLE server_health_checks (
  id UUID PRIMARY KEY,
  server_id UUID REFERENCES vpn_servers(id),
  status TEXT, -- 'online' | 'offline' | 'degraded'
  cpu_usage DECIMAL,
  ram_usage DECIMAL,
  active_peers INTEGER,
  checked_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 4. **–†–æ—Ç–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–ª –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ –µ–≥–æ —É–∫—Ä–∞–ª–∏ - –Ω–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç–æ–∑–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
- **Regenerate Config**: –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –ø–∏—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –∫–ª—é—á–∏
- –°—Ç–∞—Ä—ã–π –∫–æ–Ω—Ñ–∏–≥ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

```typescript
// API endpoint
POST /api/vpn/regenerate-config
{
  subscriptionId: "uuid"
}
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥
```

---

### 5. **–õ–∏–º–∏—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

**–ò–¥–µ—è:** –î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ç—Ä–∞—Ñ–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100GB/–º–µ—Å—è—Ü)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ê–≥–µ–Ω—Ç —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞: `wg show wg0 transfer`
- –†–∞–∑ –≤ —á–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ API
- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Ä

**–¢–∞–±–ª–∏—Ü–∞:**
```sql
CREATE TABLE traffic_usage (
  id UUID PRIMARY KEY,
  subscription_id UUID REFERENCES subscriptions(id),
  bytes_sent BIGINT,
  bytes_received BIGINT,
  measured_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 6. **–ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∫–∏**

**–¢–µ–∫—É—â–µ–µ:** –ü—Ä–æ—Å—Ç–æ —Ç–æ–∫–µ–Ω –≤ cookie

**–£–ª—É—á—à–µ–Ω–∏–µ:**
- Google Authenticator (TOTP)
- IP whitelist
- Session management (—Ç–∞–±–ª–∏—Ü–∞ active_sessions)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∞

---

### 7. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–µ–∫–∞–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ç–µ—Ä—è–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `/etc/wireguard/wg0.conf` –≤ –ë–î
- –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–µ–∫–∞–ø
- –•—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –±–µ–∫–∞–ø–æ–≤

```sql
CREATE TABLE server_config_backups (
  id UUID PRIMARY KEY,
  server_id UUID REFERENCES vpn_servers(id),
  config_content TEXT,
  peer_count INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 8. **Notification —Å–∏—Å—Ç–µ–º–∞**

**–†–∞—Å—à–∏—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –ó–∞ 3 –¥–Ω—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- –ü—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ —Ç–∏–∫–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ü—Ä–∏ –∑–∞—Ä–∞–±–æ—Ç–∫–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö

**–ö–∞–Ω–∞–ª—ã:**
- Push –≤ Telegram Mini App
- –°–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–∏—á–∫—É –æ—Ç –±–æ—Ç–∞

---

### 9. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ –±–∏–∑–Ω–µ—Å–∞**

**Dashboard –¥–ª—è –∞–¥–º–∏–Ω–∞:**
- MRR (Monthly Recurring Revenue)
- Churn rate (% –æ—Ç–≤–∞–ª–∏–≤—à–∏—Ö—Å—è)
- LTV (Lifetime Value)
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è free ‚Üí paid
- –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–≤ (–ø–æ —Å—Ç—Ä–∞–Ω–∞–º)
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ vs –ø—Ä—è–º—ã–µ)

---

### 10. **Fraud detection**

**–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏:**
- –û–¥–∏–Ω Telegram ID = –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ (–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏)
- Rate limiting –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤
- –î–µ—Ç–µ–∫—Ç VPN-–±–æ—Ç–æ–≤ (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —Å –æ–¥–Ω–æ–≥–æ IP)
- Blacklist IP –∞–¥—Ä–µ—Å–æ–≤/ASN

---

### 11. **API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π**

**–ò–¥–µ—è:** –î–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º API –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø–æ–¥–ø–∏—Å–æ–∫

**Endpoint:**
```typescript
POST /api/partner/create-subscription
Headers: X-Partner-Token: secret_key
Body: {
  telegramId: number,
  planId: string,
  referralCode?: string
}
```

**–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞:**
- –ü—Ä–æ—Ü–µ–Ω—Ç —Å –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–ª–∞—Ç—ã

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

### 1. **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

```
/modules
  /auth          # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Telegram, Admin)
  /subscriptions # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
  /payments      # TON –ø–ª–∞—Ç–µ–∂–∏
  /vpn           # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
  /referrals     # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
  /support       # –¢–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  /notifications # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  /analytics     # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏
  /monitoring    # Health checks —Å–µ—Ä–≤–µ—Ä–æ–≤
```

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å:
- **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π API** (`/api/subscriptions/*`, `/api/vpn/*` –∏ —Ç.–¥.)
- **–°–≤–æ—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (Swagger/OpenAPI)
- **–°–≤–æ–∏ —Ç–∏–ø—ã** (TypeScript interfaces)
- **–°–≤–æ–∏ —Ç–µ—Å—Ç—ã** (unit + integration)

---

### 2. **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∞–∑–≤—è–∑–∫–∏ –º–æ–¥—É–ª–µ–π:**

```typescript
// –ü—Ä–∏–º–µ—Ä: –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏
events.emit('subscription.created', {
  userId,
  planId,
  subscriptionId
})

// –°–ª—É—à–∞—Ç–µ–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö:
notifications.on('subscription.created', sendWelcomeNotification)
referrals.on('subscription.created', creditReferrer)
analytics.on('subscription.created', trackRevenue)
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** Redis Pub/Sub –∏–ª–∏ Bull Queue

---

### 3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)**

**–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å:**
- –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ (–æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É)
- –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã (–æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π (wallet_address –∏ —Ç.–¥.)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤, –±–∞–ª–∞–Ω—Å)

**TTL:**
- –°–µ—Ä–≤–µ—Ä—ã: 60 —Å–µ–∫—É–Ω–¥
- –ü–ª–∞–Ω—ã: 5 –º–∏–Ω—É—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 30 —Å–µ–∫—É–Ω–¥

---

### 4. **Graceful degradation**

**–ï—Å–ª–∏ –º–æ–¥—É–ª—å —É–ø–∞–ª - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:**

- Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∫—ç—à–∞ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- –ê–≥–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
- TON API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂ –∫–∞–∫ "pending", –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∑–∂–µ

---

### 5. **Feature Flags**

**–í–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –¥–µ–ø–ª–æ—è:**

```typescript
if (featureFlags.get('referrals_enabled')) {
  // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É
}

if (featureFlags.get('traffic_limits_enabled')) {
  // –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–∏–º–∏—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –•—Ä–∞–Ω–∏—Ç—å –≤ Redis –∏–ª–∏ env vars

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:

1. **Rate Limiting –Ω–∞ –≤—Å–µ—Ö API**
   - 100 req/min –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - 1000 req/min –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

2. **Helmet.js** –¥–ª—è HTTP headers

3. **SQL Injection –∑–∞—â–∏—Ç–∞** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Prisma/TypeORM

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - Zod schemas –Ω–∞ –∫–∞–∂–¥—ã–π endpoint

5. **Secrets Management**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker secrets –∏–ª–∏ Vault
   - –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ .env —Ñ–∞–π–ª–∞—Ö –≤ production

6. **Audit Log**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏
   - Retention 1 –≥–æ–¥

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 1. **Mock —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

```typescript
// .env.development
TELEGRAM_MOCK_MODE=true
TON_MOCK_MODE=true
VPN_AGENT_MOCK=true
```

**–ü–æ–∑–≤–æ–ª–∏—Ç:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ Telegram
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ TON –∫–æ—à–µ–ª—å–∫–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ VPN —Å–µ—Ä–≤–µ—Ä–æ–≤

---

### 2. **Seed –¥–∞–Ω–Ω—ã–µ**

```bash
npm run db:seed
```

**–°–æ–∑–¥–∞—Å—Ç:**
- 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- 3 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞
- 5 VPN —Å–µ—Ä–≤–µ—Ä–æ–≤ (mock)
- 20 –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –¢–µ—Å—Ç–æ–≤—É—é –∞–¥–º–∏–Ω—Å–∫—É—é —É—á–µ—Ç–∫—É

---

### 3. **Swagger UI** –¥–ª—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- –î–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `/api/docs`
- –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å endpoints –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ TypeScript —Ç–∏–ø–æ–≤

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**

1. **–ë–∏–∑–Ω–µ—Å:**
   - Daily Active Users (DAU)
   - Monthly Recurring Revenue (MRR)
   - Conversion rate (free ‚Üí paid)
   - Churn rate
   - Average Revenue Per User (ARPU)

2. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:**
   - API response time (p50, p95, p99)
   - Error rate (%)
   - Server uptime (%)
   - Database query time
   - Redis hit rate

3. **VPN —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ:**
   - –°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ (%)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
   - –°—Ä–µ–¥–Ω–∏–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ß–∞—Å—Ç–æ—Ç–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

---

## üéØ Roadmap (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### MVP (–ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è, 2-3 –Ω–µ–¥–µ–ª–∏):
1. ‚úÖ Telegram Mini App (UI)
2. ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ç–∞—Ä–∏—Ñ—ã
3. ‚úÖ TON –ø–ª–∞—Ç–µ–∂–∏
4. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è VPN –∫–æ–Ω—Ñ–∏–≥–æ–≤
5. ‚úÖ –ê–¥–º–∏–Ω–∫–∞
6. ‚úÖ –ê–≥–µ–Ω—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö

### Phase 2 (1-2 –Ω–µ–¥–µ–ª–∏):
1. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
2. –ü—Ä–æ–º–æ–∫–æ–¥—ã
3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (—Ç–∏–∫–µ—Ç—ã)
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### Phase 3 (2-3 –Ω–µ–¥–µ–ª–∏):
1. IP pool management
2. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
3. Health monitoring
4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Phase 4 (–±—É–¥—É—â–µ–µ):
1. –õ–∏–º–∏—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞
2. –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
3. Multi-currency (USD, EUR)
4. Mobile apps (iOS/Android)

---

## üí° –ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–¥–µ–∏

### 1. **AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏**
- ChatGPT –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–µ—Ç —Ç–∏–∫–µ—Ç—ã
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –¥–æ —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –∫ —á–µ–ª–æ–≤–µ–∫—É

### 2. **Gamification**
- "Streak" –∑–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –ë–µ–π–¥–∂–∏ –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ –∑–∞—Ä–∞–±–æ—Ç–∫—É –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö

### 3. **Family/Team –ø–ª–∞–Ω—ã**
- –û–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü + 4 —á–ª–µ–Ω–∞ —Å–µ–º—å–∏
- –û–±—â–∏–π –ø—É–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –ï–¥–∏–Ω—ã–π –ø–ª–∞—Ç–µ–∂

### 4. **Auto-renewal**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞" –ø–æ–∫–∞ –µ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞

### 5. **Geographic routing**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–µ —Å–µ—Ä–≤–µ—Ä, –∞ —Å–∞–π—Ç
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–∏–º–µ—Ä: "–°–º–æ—Ç—Ä–µ—Ç—å US Netflix" ‚Üí –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ US —Å–µ—Ä–≤–µ—Ä—É

---

## ü§î –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

1. **–°–∫–æ–ª—å–∫–æ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è?**
   - –†–µ–∫–æ–º–µ–Ω–¥—É—é: Basic (1 –∫–æ–Ω—Ñ–∏–≥), Pro (3 –∫–æ–Ω—Ñ–∏–≥–∞), Family (5 –∫–æ–Ω—Ñ–∏–≥–æ–≤)

2. **–ü—Ä–æ—Ü–µ–Ω—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã?**
   - –†–µ–∫–æ–º–µ–Ω–¥—É—é: 20% –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞, 10% –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö

3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö?**
   - –†–µ–∫–æ–º–µ–Ω–¥—É—é: 1 TON (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –º–∏–∫—Ä–æ-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ —Ä—É—á–Ω–æ–µ?**
   - –†–µ–∫–æ–º–µ–Ω–¥—É—é: –æ–ø—Ü–∏—è "–ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ" (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å)

5. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∫—Ä–æ–º–µ TON?**
   - USDT, Bitcoin?

6. **–ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ?**
   - –†–µ–∫–æ–º–µ–Ω–¥—É—é: 3-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö (US, EU, Asia)

7. **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞?**
   - –¢–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π –∏–ª–∏ multi-language (EN, RU)?

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### Must-have (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ):
1. ‚úÖ IP pool management
2. ‚úÖ Health monitoring —Å–µ—Ä–≤–µ—Ä–æ–≤
3. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
4. ‚úÖ Audit logging –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
5. ‚úÖ Rate limiting –Ω–∞ API

### Should-have (–æ—á–µ–Ω—å –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
1. üü° –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã
2. üü° –†–æ—Ç–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (regenerate)
3. üü° –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏
4. üü° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–µ–∫–∞–ø—ã

### Nice-to-have (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ):
1. üîµ –õ–∏–º–∏—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞
2. üîµ –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
3. üîµ AI-–ø–æ–¥–¥–µ—Ä–∂–∫–∞
4. üîµ Gamification

---

**–ê–≤—Ç–æ—Ä:** –°—É–ø–µ—Ä —É–º–Ω–∏–∫ (Claude) üß†
**–î–∞—Ç–∞:** 2026-01-24
**–°—Ç–∞—Ç—É—Å:** –û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
